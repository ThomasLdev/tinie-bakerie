{% extends 'base.html.twig' %}

{% block title %}Search{% if query %}: {{ query }}{% endif %}{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Search</h1>

        {# Search Form #}
        <form method="GET" action="{{ path('search') }}" class="mb-8">
            <div class="flex gap-4">
                <input
                    type="text"
                    name="q"
                    value="{{ query }}"
                    placeholder="Search posts, categories, tags..."
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required
                >
                <button
                    type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                    Search
                </button>
            </div>
        </form>

        {% if query %}
            <div class="mb-6">
                <p class="text-gray-600">
                    {% if total > 0 %}
                        Found {{ total }} result{{ total > 1 ? 's' : '' }} for "<strong>{{ query }}</strong>"
                    {% else %}
                        No results found for "<strong>{{ query }}</strong>"
                    {% endif %}
                </p>
            </div>

            {% if posts %}
                <div class="space-y-6">
                    {% for post in posts %}
                        {% set translation = post.translations|first %}
                        {% set category = post.category %}
                        {% set categoryTranslation = category ? category.translations|first : null %}

                        <article class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                            <header class="mb-4">
                                <h2 class="text-xl font-semibold mb-2">
                                    <a href="{{ path('post_show', {slug: translation.slug}) }}"
                                       class="text-blue-600 hover:text-blue-800 hover:underline">
                                        {{ translation.title }}
                                    </a>
                                </h2>

                                <div class="flex items-center gap-4 text-sm text-gray-500">
                                    <time datetime="{{ post.createdAt|date('c') }}">
                                        {{ post.createdAt|date('M d, Y') }}
                                    </time>

                                    {% if categoryTranslation %}
                                        <span class="flex items-center gap-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c1.11 0 2.08.402 2.599 1M1 1h15M1 7l4.5 4.5m0 0l4.5 4.5M2 1l2.5 2.5"></path>
                                            </svg>
                                            {{ categoryTranslation.title }}
                                        </span>
                                    {% endif %}
                                </div>
                            </header>

                            {% if translation.excerpt %}
                                <div class="text-gray-700 mb-4">
                                    {{ translation.excerpt|raw }}
                                </div>
                            {% endif %}

                            {% if post.tags|length > 0 %}
                                <footer class="flex flex-wrap gap-2">
                                    {% for tag in post.tags %}
                                        {% set tagTranslation = tag.translations|first %}
                                        {% if tagTranslation %}
                                            <span class="inline-block px-3 py-1 text-xs font-medium rounded-full"
                                                  style="background-color:{{ tag.backgroundColor }}; color:{{ tag.textColor }};"
                                            >
                                                {{ tagTranslation.title }}
                                            </span>
                                        {% endif %}
                                    {% endfor %}
                                </footer>
                            {% endif %}
                        </article>
                    {% endfor %}
                </div>
            {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}
